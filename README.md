# منصة الشكايات والتقارير (MVP)

منصة مجانية تعتمد:
- **GitHub Pages** لواجهة الموقع (HTML/JS/CSS).
- **GitHub Issues** لتخزين النصوص (كل شكوى/تقرير = Issue، كل شهادة = Comment).
- **Netlify Functions** كطبقة تحقق وإدخال (قبل إنشاء الـIssue).
- **(اختياري لكن مُستحسن)** Supabase Storage (Bucket خاص) لحفظ صور/PDF الشكايات الموقعة بشكل غير علني.

> سياسة العرض:
> - **الشكايات**: يُنشر للعامة **الملخص فقط** + الوسوم/المدينة والتاريخ (+ اسم المشتكي اختياري حسب رغبته). صورة/وثيقة الشكوى الموقعة **لا تُعرض للعامة**.
> - **التقارير**: يُنشر النص كاملًا (إلا إن احتوى بيانات حساسة).
> - **الشهادات/التعليقات**: تُعرض أسماؤهم ونصوصهم.

---

## ◾ المتطلبات
- حساب GitHub مفعّل لـ **GitHub Pages**.
- حساب Netlify (خطة مجانية).
- (اختياري) حساب Supabase (خطة مجانية).

---

## ◾ بنية الملفات

/ (جذر المستودع)
├─ index.html # واجهة الموقع (النماذج + المعرض)
├─ /netlify/functions/
│ ├─ submitComplaint.js # إدخال شكوى (يتحقق من التوقيع المرفوع) ← ينشئ Issue: type: complaint
│ ├─ submitReport.js # إدخال تقرير ← ينشئ Issue: type: report
│ ├─ submitComment.js # إضافة شهادة/تعليق على Issue
│ └─ uploadProof.js # رفع صورة/PDF الشكوى الموقعة إلى Supabase (خاص)
├─ .github/ISSUE_TEMPLATE/
│ ├─ complaint.yml # قالب Issue للشكاوى (لإنشاء يدوي/احتياطي)
│ └─ report.yml # قالب Issue للتقارير (لإنشاء يدوي/احتياطي)
├─ .github/workflows/triage.yml # (اختياري) روبوت فرز تلقائي بعد الإنشاء
└─ README.md

> يمكن تشغيل المنصة بالكامل عبر النماذج في `index.html` + وظائف Netlify. قوالب الـIssue توفر مسارًا احتياطيًا/يدويًا.

---

## ◾ متغيرات البيئة (Netlify)

في إعدادات الموقع على Netlify → **Site settings → Build & deploy → Environment**:

**وصول GitHub:**
- `GITHUB_TOKEN` : توكن شخصي (Fine-grained PAT) بصلاحية **Issues: Read/Write** على هذا المستودع فقط.
- `REPO_OWNER` : اسم حسابك في GitHub.
- `REPO_NAME`  : اسم المستودع.

**تخزين المرفقات (خاص):**
- `SUPABASE_URL`
- `SUPABASE_SERVICE_ROLE`  ← (مفتاح سري **لا يُشارك علنًا**)
- `SUPABASE_BUCKET` = `proofs` (أنشئ Bucket خاص باسم `proofs`).

> إن أردت تشغيل المشروع بدون Supabase الآن: يمكن تعطيل رفع الملفات والاكتفاء بحقل “رابط مرفق” خارجي. لكن بما أنك تشترط قبول الشكايات **الموقعة فقط**، يُفضَّل إبقاء رفع الملف مفعّل.

---

## ◾ سياسة التحقق (مطبّقة في الدوال)
- الشكوى:
  - إلزامي: الاسم الكامل، تاريخ التقديم، نوع الشكوى، **ملخص الشكوى** (≥ 120 حرفًا)، **ملف موقّع (PDF/PNG/JPG ≤ 10MB)**.
  - المرفق يُرفع إلى Supabase (خاص). لا يُنشر للعامة.
  - يُنشأ Issue بوسم: `pending`, `type: complaint`, `topic: <النوع>`, ووسوم مدينة/مكان إن وُجدت.
- التقرير:
  - إلزامي: تاريخ/وقت الواقعة، المكان، الموضوع، نص موضوعي ≥ 120 حرفًا.
  - المرفقات اختيارية (روابط أو رفع).
  - يُنشأ Issue بوسم: `pending`, `type: report`, `topic: <النوع>` إلخ.
- التعليقات/الشهادات:
  - إلزامي: الاسم الكامل + نص الشهادة ≥ 40 حرفًا.
- أي مخالفة (لغة سب/اتهامات بلا وقائع، أو نقص حقول) تُرفض بـ **422** برسالة أخطاء واضحة.

---

## ◾ الإطلاق السريع (خطوات)
1) أنشئ مستودع GitHub عامًا باسم مناسب (مثل: `civic-complaints`).
2) فعّل **GitHub Pages** من فرع `main` ومسار `/ (root)`.
3) اربط المستودع في Netlify → “New site from Git” (اختر GitHub).
4) أنشئ مجلد `netlify/functions` وأضف الدوال (سنرسِلها في ملفات لاحقة).
5) أضف متغيرات البيئة أعلاه.
6) (اختياري) أنشئ مشروع Supabase + Bucket خاص `proofs` واضبط المفاتيح.
7) ادفع (`git push`) وتأكد من نشر Netlify تلقائيًا.
8) افتح موقع GitHub Pages: يجب أن ترى الواجهة وتستطيع الإرسال (ستظهر رسالة نجاح/فشل من الدوال).

---

## ◾ واجهة الاستخدام
- **الصفحة الرئيسية (index.html)**:
  - تبويب **إضافة شكوى**: نموذج يطلب البيانات + رفع ملف موقّع (إلزامي).
  - تبويب **إضافة تقرير**: نموذج بيانات التقرير (+ مرفقات اختيارية).
  - **معرض**: بطاقات للشكايات (تعرض الملخص فقط) وبطاقات للتقارير (تعرض النص)، مع فلاتر وترتيب.
  - داخل كل بطاقة: زر “أضف شهادة/تعليق”.

---

## ◾ ملاحظات قانونية/سمعة
- لا تعرض صور التوقيعات علنًا. استخدم عبارة: “**هذه الشكوى مرفقة بوثيقة موقّعة محفوظة لدى الإدارة**”.
- راجع الشكايات يدويًا: انقلها من `pending` إلى `approved` لتظهر للعامة.
- أضف صفحات: **سياسة الخصوصية** و**شروط الاستخدام** لاحقًا.
- الإعلانات: **تؤجَّل** تمامًا لمرحلة متقدمة.

---

## ◾ القادم
- `index.html` (الواجهة) — يحتوي النماذج ومعرض الشكايات/التقارير ويربط الدوال:
  - `submitComplaint`, `submitReport`, `submitComment`, `uploadProof`.
- ثم نرسل ملفات الدوال الأربعة، ثم قوالب الـIssue، ثم (اختياري) Action الفرز.
