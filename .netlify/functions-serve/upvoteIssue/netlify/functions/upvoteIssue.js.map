{
  "version": 3,
  "sources": ["../../../../Desktop/civic-complaints-backup/netlify/functions/upvoteIssue.js"],
  "sourceRoot": "C:/Users/PC/AppData/Local/Temp/tmp-8184-eNcLRSGg6Mcr",
  "sourcesContent": ["// netlify/functions/upvoteIssue.js\r\nexport const config = { path: \"/.netlify/functions/upvoteIssue\" };\r\n\r\nfunction cors(res) {\r\n  return {\r\n    ...res,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n      \"Access-Control-Allow-Methods\": \"POST,OPTIONS\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n}\r\n\r\nexport async function handler(event) {\r\n  if (event.httpMethod === \"OPTIONS\") return cors({ statusCode: 200, body: \"\" });\r\n  if (event.httpMethod !== \"POST\") {\r\n    return cors({ statusCode: 405, body: JSON.stringify({ error: \"Method Not Allowed\" }) });\r\n  }\r\n\r\n  const { REPO_OWNER, REPO_NAME, GITHUB_TOKEN } = process.env;\r\n  if (!REPO_OWNER || !REPO_NAME || !GITHUB_TOKEN) {\r\n    return cors({ statusCode: 500, body: JSON.stringify({ error: \"Missing server env\" }) });\r\n  }\r\n\r\n  try {\r\n    const { issueNumber } = JSON.parse(event.body || \"{}\");\r\n    if (!issueNumber) {\r\n      return cors({ statusCode: 422, body: JSON.stringify({ error: \"issueNumber \u0645\u0637\u0644\u0648\u0628.\" }) });\r\n    }\r\n\r\n    // GitHub Reactions API\r\n    const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${issueNumber}/reactions`;\r\n    const res = await fetch(url, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Authorization\": `Bearer ${GITHUB_TOKEN}`,\r\n        \"Accept\": \"application/vnd.github+json, application/vnd.github.squirrel-girl-preview+json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ content: \"+1\" }),\r\n    });\r\n\r\n    // GitHub \u064A\u0631\u062C\u0639:\r\n    // 201 = Reaction \u0645\u0636\u0627\u0641\u0629\u060C 200 = Reaction \u0645\u0648\u062C\u0648\u062F\u0629 \u0645\u0633\u0628\u0642\u064B\u0627 (\u0644\u0627 \u0628\u0623\u0633)\u060C 409 = \u062A\u0639\u0627\u0631\u0636 (\u0645\u0643\u0631\u0631\u0629) \u2192 \u0646\u0639\u062A\u0628\u0631\u0647\u0627 OK\r\n    if ([200, 201, 409].includes(res.status)) {\r\n      return cors({ statusCode: 200, body: JSON.stringify({ ok: true }) });\r\n    }\r\n\r\n    const text = await res.text();\r\n    return cors({\r\n      statusCode: res.status,\r\n      body: JSON.stringify({ error: `GitHub reaction error: ${text}` }),\r\n    });\r\n  } catch (e) {\r\n    return cors({ statusCode: 500, body: JSON.stringify({ error: e.message || String(e) }) });\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACO,IAAM,SAAS,EAAE,MAAM,kCAAkC;AAEhE,SAAS,KAAK,KAAK;AACjB,SAAO;AAAA,IACL,GAAG;AAAA,IACH,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,gBAAgB;AAAA,IAClB;AAAA,EACF;AACF;AAEA,eAAsB,QAAQ,OAAO;AACnC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,GAAG,CAAC;AAC7E,MAAI,MAAM,eAAe,QAAQ;AAC/B,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,UAAU,EAAE,OAAO,qBAAqB,CAAC,EAAE,CAAC;AAAA,EACxF;AAEA,QAAM,EAAE,YAAY,WAAW,aAAa,IAAI,QAAQ;AACxD,MAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc;AAC9C,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,UAAU,EAAE,OAAO,qBAAqB,CAAC,EAAE,CAAC;AAAA,EACxF;AAEA,MAAI;AACF,UAAM,EAAE,YAAY,IAAI,KAAK,MAAM,MAAM,QAAQ,IAAI;AACrD,QAAI,CAAC,aAAa;AAChB,aAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,UAAU,EAAE,OAAO,8CAAqB,CAAC,EAAE,CAAC;AAAA,IACxF;AAGA,UAAM,MAAM,gCAAgC,UAAU,IAAI,SAAS,WAAW,WAAW;AACzF,UAAM,MAAM,MAAM,MAAM,KAAK;AAAA,MAC3B,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,iBAAiB,UAAU,YAAY;AAAA,QACvC,UAAU;AAAA,QACV,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,SAAS,KAAK,CAAC;AAAA,IACxC,CAAC;AAID,QAAI,CAAC,KAAK,KAAK,GAAG,EAAE,SAAS,IAAI,MAAM,GAAG;AACxC,aAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,UAAU,EAAE,IAAI,KAAK,CAAC,EAAE,CAAC;AAAA,IACrE;AAEA,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,WAAO,KAAK;AAAA,MACV,YAAY,IAAI;AAAA,MAChB,MAAM,KAAK,UAAU,EAAE,OAAO,0BAA0B,IAAI,GAAG,CAAC;AAAA,IAClE,CAAC;AAAA,EACH,SAAS,GAAG;AACV,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,UAAU,EAAE,OAAO,EAAE,WAAW,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC;AAAA,EAC1F;AACF;",
  "names": []
}
