{
  "version": 3,
  "sources": ["../../../../Desktop/civic-complaints-backup/netlify/functions/getComment.js"],
  "sourceRoot": "C:/Users/PC/AppData/Local/Temp/tmp-8184-r6aIVJmOtDPr",
  "sourcesContent": ["// netlify/functions/getComments.js\r\nexport const config = { path: \"/.netlify/functions/getComments\" };\r\n\r\nfunction cors(res){\r\n  return {\r\n    ...res,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n      \"Access-Control-Allow-Methods\": \"GET,OPTIONS\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n}\r\n\r\nconst toJSON = (x) => JSON.stringify(x);\r\n\r\nfunction isPending(body=\"\"){\r\n  // \u0623\u064A \u062A\u0639\u0644\u064A\u0642 \u0645\u064F\u0631\u0633\u0644 \u0639\u0628\u0631 submitComment \u0643\u0627\u0646\u062A \u0646\u0647\u0627\u064A\u062A\u0647 \u063A\u0627\u0644\u0628\u064B\u0627 \"\u0628\u0627\u0646\u062A\u0638\u0627\u0631 \u0627\u0644\u0645\u0631\u0627\u062C\u0639\u0629\"\r\n  const t = body.replace(/\\s+/g,\" \").trim();\r\n  return /\u0628\u0627\u0646\u062A\u0638\u0627\u0631 \u0627\u0644\u0645\u0631\u0627\u062C\u0639\u0629/i.test(t);\r\n}\r\n\r\nexport async function handler(event){\r\n  if (event.httpMethod === \"OPTIONS\") return cors({ statusCode: 200, body: \"\" });\r\n  if (event.httpMethod !== \"GET\") return cors({ statusCode: 405, body: toJSON({ ok:false, error:\"Method Not Allowed\" }) });\r\n\r\n  const { REPO_OWNER, REPO_NAME, GITHUB_TOKEN } = process.env;\r\n  if(!REPO_OWNER || !REPO_NAME || !GITHUB_TOKEN){\r\n    return cors({ statusCode: 500, body: toJSON({ ok:false, error:\"Missing server env\" }) });\r\n  }\r\n\r\n  try{\r\n    const issue = Number(event.queryStringParameters?.issue);\r\n    if(!Number.isFinite(issue) || issue <= 0){\r\n      return cors({ statusCode: 422, body: toJSON({ ok:false, error:\"invalid issue\" }) });\r\n    }\r\n\r\n    // \u062C\u0644\u0628 \u0627\u0644\u062A\u0639\u0644\u064A\u0642\u0627\u062A \u0645\u0646 GitHub\r\n    const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${issue}/comments?per_page=100`;\r\n    const res = await fetch(url, {\r\n      headers: {\r\n        \"Authorization\": `Bearer ${GITHUB_TOKEN}`,\r\n        \"Accept\": \"application/vnd.github+json\",\r\n      }\r\n    });\r\n    if(!res.ok){\r\n      const t = await res.text();\r\n      return cors({ statusCode: res.status, body: toJSON({ ok:false, error:`GitHub error: ${t || res.status}` }) });\r\n    }\r\n    const arr = await res.json();\r\n\r\n    // \u0641\u0644\u062A\u0631\u0629: \u0627\u0633\u062A\u0628\u0639\u062F \u201C\u0628\u0627\u0646\u062A\u0638\u0627\u0631 \u0627\u0644\u0645\u0631\u0627\u062C\u0639\u0629\u201D\r\n    const accepted = (arr || []).filter(c => !isPending(c.body || \"\")).map(c => ({\r\n      id: c.id,\r\n      author: c.user?.login || \"\u2014\",\r\n      avatar: c.user?.avatar_url || \"\",\r\n      created_at: c.created_at,\r\n      body: c.body || \"\",\r\n      html_url: c.html_url\r\n    }));\r\n\r\n    return cors({ statusCode: 200, body: toJSON({ ok:true, count: accepted.length, comments: accepted }) });\r\n  }catch(e){\r\n    return cors({ statusCode: 500, body: toJSON({ ok:false, error: e?.message || String(e) }) });\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACO,IAAM,SAAS,EAAE,MAAM,kCAAkC;AAEhE,SAAS,KAAK,KAAI;AAChB,SAAO;AAAA,IACL,GAAG;AAAA,IACH,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,gBAAgB;AAAA,IAClB;AAAA,EACF;AACF;AAEA,IAAM,SAAS,CAAC,MAAM,KAAK,UAAU,CAAC;AAEtC,SAAS,UAAU,OAAK,IAAG;AAEzB,QAAM,IAAI,KAAK,QAAQ,QAAO,GAAG,EAAE,KAAK;AACxC,SAAO,oBAAoB,KAAK,CAAC;AACnC;AAEA,eAAsB,QAAQ,OAAM;AAClC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,GAAG,CAAC;AAC7E,MAAI,MAAM,eAAe,MAAO,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,qBAAqB,CAAC,EAAE,CAAC;AAEvH,QAAM,EAAE,YAAY,WAAW,aAAa,IAAI,QAAQ;AACxD,MAAG,CAAC,cAAc,CAAC,aAAa,CAAC,cAAa;AAC5C,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,qBAAqB,CAAC,EAAE,CAAC;AAAA,EACzF;AAEA,MAAG;AACD,UAAM,QAAQ,OAAO,MAAM,uBAAuB,KAAK;AACvD,QAAG,CAAC,OAAO,SAAS,KAAK,KAAK,SAAS,GAAE;AACvC,aAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,gBAAgB,CAAC,EAAE,CAAC;AAAA,IACpF;AAGA,UAAM,MAAM,gCAAgC,UAAU,IAAI,SAAS,WAAW,KAAK;AACnF,UAAM,MAAM,MAAM,MAAM,KAAK;AAAA,MAC3B,SAAS;AAAA,QACP,iBAAiB,UAAU,YAAY;AAAA,QACvC,UAAU;AAAA,MACZ;AAAA,IACF,CAAC;AACD,QAAG,CAAC,IAAI,IAAG;AACT,YAAM,IAAI,MAAM,IAAI,KAAK;AACzB,aAAO,KAAK,EAAE,YAAY,IAAI,QAAQ,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,iBAAiB,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,CAAC;AAAA,IAC9G;AACA,UAAM,MAAM,MAAM,IAAI,KAAK;AAG3B,UAAM,YAAY,OAAO,CAAC,GAAG,OAAO,OAAK,CAAC,UAAU,EAAE,QAAQ,EAAE,CAAC,EAAE,IAAI,QAAM;AAAA,MAC3E,IAAI,EAAE;AAAA,MACN,QAAQ,EAAE,MAAM,SAAS;AAAA,MACzB,QAAQ,EAAE,MAAM,cAAc;AAAA,MAC9B,YAAY,EAAE;AAAA,MACd,MAAM,EAAE,QAAQ;AAAA,MAChB,UAAU,EAAE;AAAA,IACd,EAAE;AAEF,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,MAAM,OAAO,SAAS,QAAQ,UAAU,SAAS,CAAC,EAAE,CAAC;AAAA,EACxG,SAAO,GAAE;AACP,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAO,GAAG,WAAW,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC;AAAA,EAC7F;AACF;",
  "names": []
}
