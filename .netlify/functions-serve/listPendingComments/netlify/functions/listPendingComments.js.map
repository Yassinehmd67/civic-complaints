{
  "version": 3,
  "sources": ["../../../../Desktop/civic-complaints-backup/netlify/functions/listPendingComments.js"],
  "sourceRoot": "C:/Users/PC/AppData/Local/Temp/tmp-8184-PRUat1mY4usD",
  "sourcesContent": ["// netlify/functions/listPendingComments.js\r\nexport const config = { path: \"/.netlify/functions/listPendingComments\" };\r\n\r\nfunction cors(res) {\r\n  return {\r\n    ...res,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Headers\": \"Content-Type, Authorization\",\r\n      \"Access-Control-Allow-Methods\": \"GET,OPTIONS\",\r\n      \"Content-Type\": \"application/json\",\r\n    },\r\n  };\r\n}\r\nconst toJSON = (o) => JSON.stringify(o);\r\n\r\nexport async function handler(event) {\r\n  if (event.httpMethod === \"OPTIONS\") return cors({ statusCode: 200, body: \"\" });\r\n  if (event.httpMethod !== \"GET\") return cors({ statusCode: 405, body: toJSON({ ok:false, error:\"Method Not Allowed\" }) });\r\n\r\n  const { SUPABASE_URL, SUPABASE_SERVICE_ROLE } = process.env;\r\n  if (!SUPABASE_URL || !SUPABASE_SERVICE_ROLE) {\r\n    return cors({ statusCode: 500, body: toJSON({ ok:false, error:\"Missing Supabase env vars\" }) });\r\n  }\r\n\r\n  try {\r\n    const url = new URL(`${SUPABASE_URL}/rest/v1/pending_comments`);\r\n    url.searchParams.set(\"select\", \"id,issue_number,full_name,comment,created_at\");\r\n    url.searchParams.set(\"order\", \"created_at.desc\");\r\n    url.searchParams.set(\"limit\", \"200\");\r\n\r\n    const res = await fetch(url, {\r\n      headers: {\r\n        \"apikey\": SUPABASE_SERVICE_ROLE,\r\n        \"Authorization\": `Bearer ${SUPABASE_SERVICE_ROLE}`,\r\n        \"Accept\": \"application/json\",\r\n      }\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const t = await res.text();\r\n      return cors({ statusCode: 500, body: toJSON({ ok:false, error:`Supabase error: ${t || res.status}` }) });\r\n    }\r\n\r\n    const rows = await res.json();\r\n    return cors({ statusCode: 200, body: toJSON({ ok:true, items: rows }) });\r\n  } catch (e) {\r\n    return cors({ statusCode: 500, body: toJSON({ ok:false, error: e?.message || String(e) }) });\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACO,IAAM,SAAS,EAAE,MAAM,0CAA0C;AAExE,SAAS,KAAK,KAAK;AACjB,SAAO;AAAA,IACL,GAAG;AAAA,IACH,SAAS;AAAA,MACP,+BAA+B;AAAA,MAC/B,gCAAgC;AAAA,MAChC,gCAAgC;AAAA,MAChC,gBAAgB;AAAA,IAClB;AAAA,EACF;AACF;AACA,IAAM,SAAS,CAAC,MAAM,KAAK,UAAU,CAAC;AAEtC,eAAsB,QAAQ,OAAO;AACnC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,GAAG,CAAC;AAC7E,MAAI,MAAM,eAAe,MAAO,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,qBAAqB,CAAC,EAAE,CAAC;AAEvH,QAAM,EAAE,cAAc,sBAAsB,IAAI,QAAQ;AACxD,MAAI,CAAC,gBAAgB,CAAC,uBAAuB;AAC3C,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,4BAA4B,CAAC,EAAE,CAAC;AAAA,EAChG;AAEA,MAAI;AACF,UAAM,MAAM,IAAI,IAAI,GAAG,YAAY,2BAA2B;AAC9D,QAAI,aAAa,IAAI,UAAU,8CAA8C;AAC7E,QAAI,aAAa,IAAI,SAAS,iBAAiB;AAC/C,QAAI,aAAa,IAAI,SAAS,KAAK;AAEnC,UAAM,MAAM,MAAM,MAAM,KAAK;AAAA,MAC3B,SAAS;AAAA,QACP,UAAU;AAAA,QACV,iBAAiB,UAAU,qBAAqB;AAAA,QAChD,UAAU;AAAA,MACZ;AAAA,IACF,CAAC;AAED,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,IAAI,MAAM,IAAI,KAAK;AACzB,aAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAM,mBAAmB,KAAK,IAAI,MAAM,GAAG,CAAC,EAAE,CAAC;AAAA,IACzG;AAEA,UAAM,OAAO,MAAM,IAAI,KAAK;AAC5B,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,MAAM,OAAO,KAAK,CAAC,EAAE,CAAC;AAAA,EACzE,SAAS,GAAG;AACV,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,IAAG,OAAO,OAAO,GAAG,WAAW,OAAO,CAAC,EAAE,CAAC,EAAE,CAAC;AAAA,EAC7F;AACF;",
  "names": []
}
