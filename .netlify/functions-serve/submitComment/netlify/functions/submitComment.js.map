{
  "version": 3,
  "sources": ["../../../../Desktop/civic-complaints-backup/netlify/functions/submitComment.js"],
  "sourceRoot": "C:/Users/PC/AppData/Local/Temp/tmp-11528-z4o5fF1TL047",
  "sourcesContent": ["// netlify/functions/submitComment.js\r\nexport const config = { path: \"/.netlify/functions/submitComment\" };\r\n\r\nfunction cors(res) {\r\n  return { ...res, headers: { \"Access-Control-Allow-Origin\": \"*\", \"Access-Control-Allow-Headers\": \"Content-Type\" } };\r\n}\r\n\r\nexport async function handler(event) {\r\n  if (event.httpMethod === \"OPTIONS\") return cors({ statusCode: 200, body: \"\" });\r\n  if (event.httpMethod !== \"POST\")  return cors({ statusCode: 405, body: \"Method Not Allowed\" });\r\n\r\n  const { REPO_OWNER, REPO_NAME, GITHUB_TOKEN } = process.env;\r\n  if (!REPO_OWNER || !REPO_NAME || !GITHUB_TOKEN) {\r\n    return cors({ statusCode: 500, body: \"Missing server env\" });\r\n  }\r\n\r\n  try {\r\n    const { issueNumber, fullName, comment } = JSON.parse(event.body || \"{}\");\r\n    const errs = [];\r\n    if (!issueNumber) errs.push(\"\u0631\u0642\u0645 \u0627\u0644\u0639\u0646\u0635\u0631 \u0645\u0641\u0642\u0648\u062F.\");\r\n    if (!fullName || fullName.trim().length < 8) errs.push(\"\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644 \u0645\u0637\u0644\u0648\u0628.\");\r\n    if (!comment || comment.trim().length < 40) errs.push(\"\u0627\u0644\u062A\u0639\u0644\u064A\u0642 \u0642\u0635\u064A\u0631 (\u2265 40 \u062D\u0631\u0641\u064B\u0627).\");\r\n    if (errs.length) return cors({ statusCode: 422, body: errs.join(\" \") });\r\n\r\n    const body = `**\u0627\u0644\u0627\u0633\u0645 \u0627\u0644\u0643\u0627\u0645\u0644:** ${fullName}\\n\\n${comment}\\n\\n_(\u0628\u0627\u0646\u062A\u0638\u0627\u0631 \u0627\u0644\u0645\u0631\u0627\u062C\u0639\u0629)_`;\r\n\r\n    const res = await fetch(`https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/issues/${issueNumber}/comments`, {\r\n      method: \"POST\",\r\n      headers: {\r\n        \"Authorization\": `Bearer ${GITHUB_TOKEN}`,\r\n        \"Accept\": \"application/vnd.github+json\",\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      body: JSON.stringify({ body })\r\n    });\r\n\r\n    if (!res.ok) {\r\n      const t = await res.text();\r\n      return cors({ statusCode: 500, body: `GitHub error: ${t}` });\r\n    }\r\n    return cors({ statusCode: 200, body: \"OK\" });\r\n  } catch (e) {\r\n    return cors({ statusCode: 500, body: String(e.message || e) });\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACO,IAAM,SAAS,EAAE,MAAM,oCAAoC;AAElE,SAAS,KAAK,KAAK;AACjB,SAAO,EAAE,GAAG,KAAK,SAAS,EAAE,+BAA+B,KAAK,gCAAgC,eAAe,EAAE;AACnH;AAEA,eAAsB,QAAQ,OAAO;AACnC,MAAI,MAAM,eAAe,UAAW,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,GAAG,CAAC;AAC7E,MAAI,MAAM,eAAe,OAAS,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,qBAAqB,CAAC;AAE7F,QAAM,EAAE,YAAY,WAAW,aAAa,IAAI,QAAQ;AACxD,MAAI,CAAC,cAAc,CAAC,aAAa,CAAC,cAAc;AAC9C,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,qBAAqB,CAAC;AAAA,EAC7D;AAEA,MAAI;AACF,UAAM,EAAE,aAAa,UAAU,QAAQ,IAAI,KAAK,MAAM,MAAM,QAAQ,IAAI;AACxE,UAAM,OAAO,CAAC;AACd,QAAI,CAAC,YAAa,MAAK,KAAK,yFAAmB;AAC/C,QAAI,CAAC,YAAY,SAAS,KAAK,EAAE,SAAS,EAAG,MAAK,KAAK,qGAAqB;AAC5E,QAAI,CAAC,WAAW,QAAQ,KAAK,EAAE,SAAS,GAAI,MAAK,KAAK,iHAA4B;AAClF,QAAI,KAAK,OAAQ,QAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,KAAK,GAAG,EAAE,CAAC;AAEtE,UAAM,OAAO,4EAAqB,QAAQ;AAAA;AAAA,EAAO,OAAO;AAAA;AAAA;AAExD,UAAM,MAAM,MAAM,MAAM,gCAAgC,UAAU,IAAI,SAAS,WAAW,WAAW,aAAa;AAAA,MAChH,QAAQ;AAAA,MACR,SAAS;AAAA,QACP,iBAAiB,UAAU,YAAY;AAAA,QACvC,UAAU;AAAA,QACV,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,KAAK,CAAC;AAAA,IAC/B,CAAC;AAED,QAAI,CAAC,IAAI,IAAI;AACX,YAAM,IAAI,MAAM,IAAI,KAAK;AACzB,aAAO,KAAK,EAAE,YAAY,KAAK,MAAM,iBAAiB,CAAC,GAAG,CAAC;AAAA,IAC7D;AACA,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,KAAK,CAAC;AAAA,EAC7C,SAAS,GAAG;AACV,WAAO,KAAK,EAAE,YAAY,KAAK,MAAM,OAAO,EAAE,WAAW,CAAC,EAAE,CAAC;AAAA,EAC/D;AACF;",
  "names": []
}
